# Gemini SQLite Batch Translator

Этот набор скриптов предназначен для пакетного перевода содержимого словаря в формате `.zip` (Yomitan) с использованием Google Gemini API. Процесс состоит из трёх этапов: конвертация словаря в SQLite, пакетный перевод через API и обратная конвертация в формат Yomitan.

## Зависимости

Для работы скриптов вам понадобятся:
*   **Python 3**
*   **curl** (для API-запросов)
*   **jq** (для обработки JSON-ответов)
*   **sqlite3** (для работы с базой данных)

## Установка зависимостей

*   **Debian/Ubuntu:**
    ```bash
    sudo apt update
    sudo apt install python3 curl jq sqlite3
    ```
*   **Arch Linux:**
    ```bash
    sudo pacman -Syu python curl jq sqlite
    ```
*   **Android (Termux):**
    ```bash
    pkg update
    pkg install python curl jq sqlite
    ```
*   **Другие системы:**
    Найдите способ установить `python3`, `curl`, `jq` и `sqlite3` с помощью вашего менеджера пакетов.

---

## Пошаговая инструкция

### Шаг 1: Клонирование репозитория

Сначала клонируйте репозиторий и перейдите в созданную директорию:
```bash
git clone https://github.com/AAlx0451/yomitan_sqlite_translator/
cd yomitan_sqlite_translator
```

### Шаг 2: Настройка API ключа

Для работы с Gemini API требуется ключ.

1.  Получите ваш API ключ в [Google AI Studio](https://aistudio.google.com/apikey).
2.  Экспортируйте его как переменную окружения. Вы можете делать это для каждой сессии терминала:
    ```bash
    export GOOGLE_API_KEY="ВАШ_API_КЛЮЧ"
    ```
3.  Для постоянного использования добавьте эту строку в ваш конфигурационный файл оболочки (`~/.bashrc`, `~/.zshrc` и т.д.):
    ```bash
    echo 'export GOOGLE_API_KEY="ВАШ_API_КЛЮЧ"' >> ~/.bashrc
    source ~/.bashrc # Применить изменения немедленно
    ```

### Шаг 3: Подготовка базы данных

Скрипт `process.py` конвертирует словарь в формате `.zip` (Yomitan) в базу данных SQLite.

1.  Поместите ваш `.zip` файл со словарём в папку с проектом под названием `dict.zip`.
2.  Запустите скрипт конвертации:
    ```bash
    python process.py
    ```
    После выполнения этой команды в папке появится файл `dict.db`.

### Шаг 4: Настройка скрипта перевода

Перед запуском основного скрипта `translate.sh` откройте его в текстовом редакторе (`nano`, `vim` и т.д.) и настройте основные параметры в секции `--- Настройки ---`:

```bash
# --- Настройки ---
DB_FILE="dict.db"        # Путь к файлу базы данных SQLite
TABLE_NAME="dictionary"        # Имя таблицы со словами
SRC_COLUMN="english"             # Название колонки с исходным текстом
DST_COLUMN="russian"             # Название колонки, куда будет сохранён перевод
PK_COLUMN="id"                # Первичный ключ (обычно можно не менять)

BATCH_SIZE=300                   # Количество строк для перевода за один API-запрос
MODEL="gemini-2.5-flash-lite"    # Модель Gemini для использования
SRC_LANG="english"               # Исходный язык (для промпта)
DST_LANG="russian"               # Целевой язык (для промпта)
```

### Шаг 5: Запуск перевода

Сделайте скрипт исполняемым и запустите его:
```bash
chmod +x translate.sh
./translate.sh
```
Скрипт начнёт отправлять слова пакетами (батчами) в Gemini API и сохранять переводы в базу данных. Вы будете видеть прогресс в терминале.

### Шаг 6: Проверка перевода

*{TODO}*

### Шаг 7: Конвертация обратно в Yomitan

После того как все строки будут переведены, используйте скрипт `reverse.py` для создания финального `.zip` файла словаря для Yomitan:
```bash
python reverse.py
```
Файл `dict_trans.zip` готов к использованию.

---

## Функции и возможности

*   **Пакетная обработка:** Эффективно переводит большие объемы текста, отправляя их пакетами для минимизации количества API-запросов.
*   **Гибкая настройка:** Позволяет легко изменять модель Gemini, языки, названия таблиц и колонок прямо в файле скрипта.
*   **Возобновление работы:** Скрипт автоматически находит непереведённые строки и продолжает работу с места остановки.
*   **Интерактивное управление ошибками:** В случае сбоя API (например, из-за неверного ключа или проблем с моделью) скрипт предложит:
    *   **[k]** - сменить API ключ на лету.
    *   **[m]** - выбрать другую модель из доступного списка.
    *   **[q]** - прервать выполнение.
*   **Частичное сохранение:** Если API возвращает некорректное количество строк, скрипт пытается сохранить максимально возможное количество корректных переводов из пакета, чтобы минимизировать потери.
*   **Поддержка нескольких моделей:** Вы можете выбрать одну из доступных моделей: `gemini-2.5-flash`, `gemini-2.5-flash-lite`, `gemini-2.5-pro`, `gemini-2.0-flash`, `gemini-1.5-flash`.
